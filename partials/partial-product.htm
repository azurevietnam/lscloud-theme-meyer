---
description: 'Product object'
---
{# filter products #}
{% set filtered = [] %}
{% set brand_ids = [] %}
{% set brands = [] %}
{% set max_filtered_price = 0 %}
{% for product in products %}
  {% if product.manufacturer.id and product.manufacturer.id not in brand_ids %}
    {% set brands = brands|merge([product.manufacturer]) %}
    {% set brand_ids = brand_ids|merge([product.manufacturer.id]) %}
  {% endif %}
  {% if (not param('search') or param('search')|lower in product.name|lower)
      and (not param('sale') or param('sale') != "true" or product.is_on_sale)
      and (not param('brand') or param('brand') == product.manufacturer.id) %}
    {% set max_filtered_price = max(product.price, max_filtered_price) %}
    {% if not param('price') or param('price') >= product.price %}
      {% set filtered = filtered|merge([product]) %}
    {% endif %}
  {% endif %}
{% endfor %}
"products": [
{% for product in filtered[param('start')|default(0):param('length')|default(100)] %}
  {
      "id": {{ product.id }},
      "name" : "{{ product.name | unescape }}",
      "sku" : "{{ product.sku }}",
      "description" : "{{ product.short_description | escape("html_attr") }}",
      "url_name": "{{ product.url_name }}",
      "price": {{ product.price }},
      "on_sale": {{ product.is_on_sale is same as(1) ? "true" : "false" }},
      "manufacturer": "{{ product.manufacturer.name }}",
      "manufacturer_url": "{{ product.manufacturer.url_name }}",
      "categories": [
        {% for category in product.categories %}
          "{{ category.url_name }}"{% if not loop.last %},{% endif %}
        {% endfor %}
      ],
      "thumbnail": "{{ product.images.first.thumbnail(500, 'auto')|default('http://placehold.it/460x300') }}",
      "options": [
        {% for option in product.options %}
        {
          "id": {{ option.id }},
          "name": "{{ option.name }}",
          "values": [
            {% for value in option.values  %}
              "{{ value }}"{% if not loop.last %},{% endif %}
            {% endfor %}
          ]
        }
          {% if not loop.last %},{% endif %}
        {% endfor %}
      ]
  }
{% if not loop.last %},{% endif %}
{% endfor %}
],
"count": {{ filtered|length }},
"max_price": {{ max_filtered_price }},
"brands": [
{% for brand in brands %}
  {
    "id": {{ brand.id }},
    "name": "{{ brand.name }}",
    "url": "{{ brand.url_name }}"
  }
  {% if not loop.last %},{% endif %}
{% endfor %}
]
